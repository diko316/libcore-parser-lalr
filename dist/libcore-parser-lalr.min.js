!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("libcore"),require("libcore-tokenizer")):"function"==typeof define&&define.amd?define("libcore-parser-lalr",["libcore","libcore-tokenizer"],e):"object"==typeof exports?exports["libcore-parser-lalr"]=e(require("libcore"),require("libcore-tokenizer")):r["libcore-parser-lalr"]=e(r.libcore,r.libcoreTokenizer)}(this,function(r,e){return function(r){function e(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var t={};return e.m=r,e.c=t,e.i=function(r){return r},e.d=function(r,t,n){e.o(r,t)||Object.defineProperty(r,t,{configurable:!1,enumerable:!0,get:n})},e.n=function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(t,"a",t),t},e.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},e.p="/assets/",e(e.s=11)}([function(e,t){e.exports=r},function(r,e,t){"use strict";function n(r,e){var t=o,n=a;if(!t.string(r))throw new Error("Invalid iterator name parameter.");if(!t.method(e)||e!==n&&!(e.prototype instanceof n))throw new Error("Invalid iterator Class parameter.");return s[":"+r]=e,!0}function i(r){var e=s;return o.string(r)&&(r=":"+r)in e?e[r]:null}var o=t(0),a=t(4),s={};n("base",a),r.exports={defaultIterator:"base",Base:a,register:n,get:i}},function(r,e,t){"use strict";function n(r,e,t){return new s(r,e,t)}function i(r){var e,t=a;if(t.string(r))try{r=JSON.parse(r)}catch(r){throw new Error("Unable to load from invalid json JSON String parameter: "+r.toString())}else if(!t.object(r))throw new Error("Unable to load from invalid json Object parameter.");e=new s;try{e.fromJSON(r)}catch(r){throw new Error(r)}return e}function o(r){return r instanceof s}var a=t(0),s=t(5),u=t(1);r.exports={Parser:s,Iterator:u.Base,isParser:o,define:n,load:i,registerIterator:u.register}},function(r,e,t){"use strict";function n(){}function i(r){var e=n;return e.prototype=r,new e}r.exports={clone:i}},function(r,e,t){"use strict";function n(r){if(!i.object(r))throw new Error("Invalid parser parameter.");this.parser=r,this.reset(),this.start=":start"}var i=t(0);n.prototype={constructor:n,subject:"",returns:!1,current:null,ready:!1,completed:!1,error:null,actions:{":start":{0:":fail",1:":tokenize"},":tokenize":{0:":fail",1:":tokenize",2:":shift",3:":reduce"},":shift":{0:":fail",1:":tokenize"},":reduce":{0:":fail",1:":shift",2:":reduce",3:":success"},":fail":{},":success":{}},":start":function(){var r=this;return r.params=r.nextTokenIndex,1},":tokenize":function(r){var e,t,n,i=this,o=i.parser,a=o.map,s=a.ends,u=a.states,l=i.pstate,c=o.tokenizer.tokenize(r,i.subject);if(c){if(e=c[0],t=c[2],!this.isAcceptableToken(c))return i.params=t,1;if(i.nextTokenIndex=t,i.params=i.createLexeme(e,c[1],null,0,r,t,null),n=u[l],e in n)return 2}return i.buffer.length&&l in s?3:(i.params="Invalid token",0)},":shift":function(r){var e=this,t=e.buffer,n=e.parser.map.states,i=e.pstate,o=r.name;return t[t.length]=[i,r],e.pstate=n[i][o],e.current=r,e.params=null,e.returns="$"!==o,e.params=e.nextTokenIndex,1},":reduce":function(r){for(var e,t,n,i,o,a,s=this,u=s.parser.map,l=s.buffer,c=l.length,f=u.ends,h=u.states,d=s.pstate,p=f[d],m=p[0],v=p[1],w=[],x=v,g=x-1;x--;)t=l[--c],d=t[0],e=t[1],n=e.from,x===g&&(i=e.to),w[x]=e;return l.length=c,s.current=a=s.createLexeme(m,null,w,v,n,i,p[2]),"$end"===m?0===c?(a.params=1,a.children=[a.children[0]],a.ruleIndex=!0,s.params=a,3):(s.params="Failed last reduce",0):(l[c++]=[d,a],s.returns=!0,d=h[d][m],o=h[d],m=r.name,s.pstate=d,m in o?1:d in f?2:(s.params="failed reduce! inside :reduce",0))},":success":function(r){var e=this;return e.completed=e.returns=!0,e.current=r,!1},":fail":function(r){var e=this;return e.error=r,e.completed=!0,!1},isAcceptableToken:function(r){return!(r[0]in this.parser.map.exclude)},createLexeme:function(r,e,t,n,i,o,a){return{name:r,params:n,value:e,children:t,from:i,to:o,ruleIndex:a||r}},update:function(r){var e=this,t=e.current;return!e.error&&t&&(t.value=r),this},reset:function(){var r=this.parser;this.nextTokenIndex=0,this.cursor=0,this.buffer=[],this.state=this.start,this.pstate=r.map.start,this.params=null,this.subject||delete this.ready,delete this.complete,delete this.error,delete this.returns,delete this.current},set:function(r){if(!i.string(r))throw new Error("Invalid String subject parameter.");this.reset(),this.subject=r,this.ready=!0},next:function(){var r,e,t,n,o,a=this,s=a.actions,u=i.number,l=a.completed,c=!1;for(l||delete a.current;!l;){if(r=a.state,e=a.params,!(r in a))throw new Error("No handler found for state "+r);if(t=a[r](e),c=a.returns,delete a.returns,o=a.current,l=a.completed,a.error)break;if(!l){if(!u(t))throw new Error("Invalid result from state handler"+r);if(n=s[r],!(t in n))throw new Error("Invalid result from state handler"+r);a.state=n[t]}if(!0===c)return o}return!(a.error||!l)&&null}},r.exports=n},function(r,e,t){"use strict";function n(r,e,t){this.tokenizer=new o,this.map=new a,arguments.length&&this.define(r,e,t)}var i=t(0),o=t(10),a=t(8),s=t(6),u=t(1);n.prototype={subject:"",tokenizer:null,map:null,ready:!1,constructor:n,iterator:function(r){var e,t=u;if(arguments.length){if(!(e=t.get(r)))throw new Error("Invalid iterator name parameter.")}else e=t.get(t.defaultIterator);return new e(this)},define:function(r,e,t){var n,o=i,a=o.array;if(a(t)||(t=[]),!o.string(r))throw new Error("Invalid root grammar rule parameter.");if(!a(e))throw new Error("Invalid grammar rules definition parameter");return this.ready=n=s(r,this.map,this.tokenizer,e,t),n},fromJSON:function(r){var e,t=i,n=t.object;if(t.string(r))try{r=JSON.parse(r)}catch(r){throw new Error("Invalid JSON String json parameter.")}if(!n(r))throw new Error("Invalid Object json parameter.");if(e=r.tokens,!n(e))throw new Error('Invalid "tokens" property of json parameter.');return this.tokenizer.fromJSON(e),this.map.importStates(r),this},toJSON:function(){return JSON.stringify(this.toObject())},toObject:function(){var r;if(!this.ready)throw new Error("Grammar rules is not yet defined.");return r=this.map.toObject(),r.tokens=this.tokenizer.toObject(),r},parse:function(r,e,t){var n,o,a,s=i,u=s.string,l=[],c=0;if(!u(r))throw new Error("Invalid string subject parameter");if(!(t=s.string(t)?this.iterator(t):this.iterator()))throw new Error("Invalid Iterator parameter.");for(s.object(e)||(e={}),t.set(r),n=t.next();n;n=t.next())l[c++]=n,(o=n.name)in e&&(a=e[o](o,n.value,n),void 0!==a?n.value=a:0!==n.params&&(n.value=null));return!t.error&&l}},r.exports=n},function(r,e,t){"use strict";function n(r,e,t,n){var i,a,u,l,c,f,h,d,p,m,v=t.rules,w=t.ruleIndex,x=t.terminal,g=t.lexIndex,b=t.ruleNames,I=s,E=o,j=E.string,y=E.regex;if((j(e)||y(e))&&(e=[e]),!E.array(e))throw new Error("Invalid grammar rule found in "+r);for(h=d=null,u=[],i=e.length;i--;){if(a=e[i],y(a))a.source,l="/"+a.source+"/",l in x||(n.define([l,a]),x[l]=l),a=l;else{if(!j(a))throw new Error("Invalid token in grammar rule "+a);if(!I.test(a))throw new Error("Invalid grammar rule name format: "+a)}u[i]=a,m="r"+ ++t.rgenId,g[m]=a,c=[m,a,h],h||(d=c),h=c}if(f=" -> "+u.join(","),r+":",(l=r+f)in w)throw new Error("Grammar rule is already defined "+r+f);return w[l]=!0,r in v||(v[r]=null,b[b.length]=r),h=[!1,null,h],p=v[r],p&&(d[2]=p),v[r]=h,[h[2][0],d[0]]}function i(r,e,t,i,u){var l,c,f,h,d,p,m,v,w,x,g,b,I=o,E=I.string,j=I.array,y=n,k=s;for(d=null,m={},v={rgenId:0,ruleNames:[],rules:m,terminal:b={},lexIndex:{},ruleIndex:{},ruleGroup:w={}},i.splice(i.length,0,"$end",[[r,"$"]]),l=-1,c=i.length;c--;)if(p=i[++l],E(p)){if(!k.test(p))throw new Error("Invalid grammar rule name "+p);d=p}else{if(!j(p))throw new Error("Invalid item in definitions parameter.");if(!d)throw new Error("Invalid grammar rules parameter.");for(f=-1,h=p.length;h--;)x=y(d,p[++f],v,t),w[x[1]]=d+(f+1)}if(u)for(u=u.slice(0),g=I.regex,c=u.length;c--;){if(p=u[c],!g(p))throw new Error("Invalid exclude token parameter.");d="/"+p.source+"/",d in b?u.splice(c,1):(t.define([d,p]),b[d]=d,u[c]=d)}if(!I.contains(m,r))throw new Error("Invalid root grammar rule parameter.");return a(v,e,u)}var o=t(0),a=t(7),s=/^([A-Z][a-zA-Z]+(\_?[a-zA-Z0-9])*|\$end|\$)$/;r.exports=i},function(r,e,t){"use strict";function n(r,e,t){var n,o,a,s,u,l,c,f,h,d,p=i,m=r.rules,v=r.ruleGroup,w=new p(e,e.start),x=[[w,"$end"]],g=1;for(e.reset(),t&&e.setExcludes(t);g--;)for(n=x.splice(0,1)[0],u=n[0],o=n[1],a=m[o];a;a=d)l=a[0],d=a[2],!1===l?(c=0,w=u):(s=a[1],c++,s in m&&(h=w.rid,(h=h?h+"-"+l:l)in w||(f=w.clone(l),f[h]=f,x[g++]=[f,s])),w=w.point(s),d&&!1!==d[0]||w.reduce(o,c,v[l]));return!0}var i=t(9);r.exports=n},function(r,e,t){"use strict";function n(){this.reset()}var i=t(0);n.prototype={stateGen:0,constructor:n,generateState:function(){var r="s"+ ++this.stateGen;return this.states[r]={},r},setAnchorState:function(r){r in this.anchors||(this.anchors[r]=!0)},setReduceState:function(r,e,t,n){var i,o=this.ends;if(r in o){if(i=o[r],i[0]!==e||i[1]!==t)throw console.log(this),new Error("Reduce conflict found "+i[0]+" ! <- "+e)}else o[r]=[e,t,n]},reset:function(){var r={};r.$start={},this.start="$start",this.states=r,this.anchors={},this.ends={},this.exclude={}},setExcludes:function(r){var e,t,n=this.exclude;if(i.array(r))for(e=-1,t=r.length;t--;)n[r[++e]]=!0},importStates:function(r){var e,t,n,o,a=i,s=a.object;if(!s(r))throw new Error("Invalid Object definition parameter.");if(t=r.states,!s(t))throw new Error('Invalid "states" Object in definition parameter.');if(e=r.start,!(a.string(e)&&e in t))throw new Error('Invalid "start" state in definition parameter.');if(n=r.anchors,!s(n))throw new Error('Invalid "anchors" states in definition parameter.');if(o=r.ends,!s(n))throw new Error('Invalid "ends" states in definition parameter.');return this.start=e,this.states=t,this.anchors=n,this.ends=o,!0},toObject:function(){return{start:this.start,states:this.states,anchors:this.anchors,ends:this.ends}},exportStates:function(r){var e=this.toObject();if(!0===r)try{return JSON.stringify(e)}catch(r){return null}return e}},r.exports=n},function(r,e,t){"use strict";function n(r,e){this.id=e,this.map=r,this.pointer={},this.lexemes=[]}var i=t(3);n.prototype={constructor:n,id:null,pointer:null,parent:null,rid:null,lexemes:null,clone:function(r){var e=i.clone(this);return r&&(e.rid=r),e.parent=this,e},point:function(r){var e,t,n=this.pointer,i=this.lexemes,o=this.map;return r in n||(t=this.map.generateState(),e=this.clone(),e.id=t,e.pointer={},e.lexemes=[],i[i.length]=r,n[r]=e,o.states[this.id][r]=t),n[r]},reduce:function(r,e,t){this.map.setReduceState(this.id,r,e,t)}},r.exports=n},function(r,t){r.exports=e},function(r,e,t){r.exports=t(2)}])});