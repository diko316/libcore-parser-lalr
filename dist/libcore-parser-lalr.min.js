!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("libcore"),require("libcore-tokenizer")):"function"==typeof define&&define.amd?define("libcore-parser-lalr",["libcore","libcore-tokenizer"],e):"object"==typeof exports?exports["libcore-parser-lalr"]=e(require("libcore"),require("libcore-tokenizer")):r["libcore-parser-lalr"]=e(r.libcore,r.libcoreTokenizer)}(this,function(r,e){return function(r){function e(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var t={};return e.m=r,e.c=t,e.i=function(r){return r},e.d=function(r,t,n){e.o(r,t)||Object.defineProperty(r,t,{configurable:!1,enumerable:!0,get:n})},e.n=function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(t,"a",t),t},e.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},e.p="/assets/",e(e.s=11)}([function(e,t){e.exports=r},function(r,e,t){"use strict";function n(r,e){var t=o,n=s;if(!t.string(r))throw new Error("Invalid iterator name parameter.");if(!t.method(e)||e!==n&&!(e.prototype instanceof n))throw new Error("Invalid iterator Class parameter.");return a[":"+r]=e,!0}function i(r){var e=a;return o.string(r)&&(r=":"+r)in e?e[r]:null}var o=t(0),s=t(4),a={};n("base",s),r.exports={defaultIterator:"base",Base:s,register:n,get:i}},function(r,e,t){"use strict";function n(r,e,t){return new a(r,e,t)}function i(r){var e,t=s;if(t.string(r))try{r=JSON.parse(r)}catch(r){throw new Error("Unable to load from invalid json JSON String parameter: "+r.toString())}else if(!t.object(r))throw new Error("Unable to load from invalid json Object parameter.");e=new a;try{e.fromJSON(r)}catch(r){throw new Error(r)}return e}function o(r){return r instanceof a}var s=t(0),a=t(5),u=t(1);r.exports={Parser:a,Iterator:u.Base,isParser:o,define:n,load:i,registerIterator:u.register}},function(r,e,t){"use strict";function n(){}function i(r){var e=n;return e.prototype=r,new e}r.exports={clone:i}},function(r,e,t){"use strict";function n(r){if(!i.object(r))throw new Error("Invalid parser parameter.");this.parser=r,this.reset(),this.start=":start"}var i=t(0);n.prototype={constructor:n,subject:"",returns:!1,current:null,ready:!1,completed:!1,error:null,actions:{":start":{0:":fail",1:":shift",2:":reduce"},":shift":{0:":fail",1:":start"},":reduce":{0:":fail",1:":shift",2:":reduce",3:":success"},":fail":{},":success":{}},":start":function(){for(var r,e,t,n=this,i=n.parser,o=i.map,s=o.states,a=o.ends,u=o.exclude,c=i.tokenizer,l=n.nextTokenIndex,f=n.pstate,h=c.tokenize(l,n.subject);h&&(r=h[0])in u;h=c.tokenize(l,n.subject))l=h[2];return h&&(e=s[f],t=h[2],n.nextTokenIndex=t,n.params=n.createLexeme(r,h[1],null,0,l,t),r in e)?1:n.buffer.length?f in a?2:(n.params="failed reduce!",0):(n.params="Failed from start",0)},":shift":function(r){var e=this,t=e.buffer,n=e.parser.map.states,i=e.pstate,o=r.name;return t[t.length]=[i,r],e.pstate=n[i][o],e.current=r,e.params=null,e.returns="$"!==o,1},":reduce":function(r){for(var e,t,n,i,o,s,a=this,u=a.parser.map,c=a.buffer,l=c.length,f=u.ends,h=u.states,d=a.pstate,p=f[d],m=p[0],w=p[1],v=[],g=w,x=g-1;g--;)t=c[--l],d=t[0],e=t[1],n=e.from,g===x&&(i=e.to),v[g]=e;return c.length=l,a.current=s=a.createLexeme(m,null,v,w,n,i),"$end"===m?0===l?(s.params=1,s.children=[s.children[0]],a.params=s,3):(a.params="Failed last reduce",0):(c[l++]=[d,s],a.returns=!0,d=h[d][m],o=h[d],m=r.name,a.pstate=d,m in o?1:d in f?2:(a.params="failed reduce! inside :reduce",0))},":success":function(r){var e=this;return e.completed=e.returns=!0,e.current=r,!1},":fail":function(r){var e=this;return e.error=r,e.completed=!0,!1},createLexeme:function(r,e,t,n,i,o){return{name:r,params:n,value:e,children:t,from:i,to:o}},update:function(r){var e=this,t=e.current;return!e.error&&t&&(t.value=r),this},reset:function(){var r=this.parser;this.nextTokenIndex=0,this.cursor=0,this.buffer=[],this.state=this.start,this.pstate=r.map.start,this.params=null,this.subject||delete this.ready,delete this.complete,delete this.error,delete this.returns,delete this.current},set:function(r){if(!i.string(r))throw new Error("Invalid String subject parameter.");this.reset(),this.subject=r,this.ready=!0},next:function(){var r,e,t,n,o,s=this,a=s.actions,u=i.number,c=s.completed,l=!1;for(c||delete s.current;!c;){if(r=s.state,e=s.params,!(r in s))throw new Error("No handler found for state "+r);if(t=s[r](e),l=s.returns,delete s.returns,o=s.current,c=s.completed,s.error)break;if(!c){if(!u(t))throw new Error("Invalid result from state handler"+r);if(n=a[r],!(t in n))throw new Error("Invalid result from state handler"+r);s.state=n[t]}if(!0===l)return o}return!(s.error||!c)&&null}},r.exports=n},function(r,e,t){"use strict";function n(r,e,t){this.tokenizer=new o,this.map=new s,arguments.length&&this.define(r,e,t)}var i=t(0),o=t(10),s=t(8),a=t(6),u=t(1);n.prototype={subject:"",tokenizer:null,map:null,ready:!1,constructor:n,iterator:function(r){var e,t=u;if(arguments.length){if(!(e=t.get(r)))throw new Error("Invalid iterator name parameter.")}else e=t.get(t.defaultIterator);return new e(this)},define:function(r,e,t){var n,o=i,s=o.array;if(s(t)||(t=[]),!o.string(r))throw new Error("Invalid root grammar rule parameter.");if(!s(e))throw new Error("Invalid grammar rules definition parameter");return this.ready=n=a(r,this.map,this.tokenizer,e,t),n},fromJSON:function(r){var e,t=i,n=t.object;if(t.string(r))try{r=JSON.parse(r)}catch(r){throw new Error("Invalid JSON String json parameter.")}if(!n(r))throw new Error("Invalid Object json parameter.");if(e=r.tokens,!n(e))throw new Error('Invalid "tokens" property of json parameter.');return this.tokenizer.fromJSON(e),this.map.importStates(r),this},toJSON:function(){return JSON.stringify(this.toObject())},toObject:function(){var r;if(!this.ready)throw new Error("Grammar rules is not yet defined.");return r=this.map.toObject(),r.tokens=this.tokenizer.toObject(),r},parse:function(r,e,t){var n,o,s,a=i,u=a.string,c=[],l=0;if(!u(r))throw new Error("Invalid string subject parameter");if(!(t=a.string(t)?this.iterator(t):this.iterator()))throw new Error("Invalid Iterator parameter.");for(a.object(e)||(e={}),t.set(r),n=t.next();n;n=t.next())c[l++]=n,(o=n.name)in e&&(s=e[o](o,n.value,n),void 0!==s?n.value=s:0!==n.params&&(n.value=null));return!t.error&&c}},r.exports=n},function(r,e,t){"use strict";function n(r,e,t,n){var i,s,u,c,l,f,h,d,p,m,w=t.rules,v=t.ruleIndex,g=t.terminal,x=t.lexIndex,b=t.ruleNames,I=a,E=o,j=E.string,y=E.regex;if((j(e)||y(e))&&(e=[e]),!E.array(e))throw new Error("Invalid grammar rule found in "+r);for(h=d=null,u=[],i=e.length;i--;){if(s=e[i],y(s))s.source,c="/"+s.source+"/",c in g||(n.define([c,s]),g[c]=c),s=c;else{if(!j(s))throw new Error("Invalid token in grammar rule "+s);if(!I.test(s))throw new Error("Invalid grammar rule name format: "+s)}u[i]=s,m="r"+ ++t.rgenId,x[m]=s,l=[m,s,h],h||(d=l),h=l}if(f=" -> "+u.join(","),r+":",(c=r+f)in v)throw new Error("Grammar rule is already defined "+r+f);v[c]=!0,r in w||(w[r]=null,b[b.length]=r),h=[!1,null,h],p=w[r],p&&(d[2]=p),w[r]=h}function i(r,e,t,i,u){var c,l,f,h,d,p,m,w,v,g,x=o,b=x.string,I=x.array,E=n,j=a;for(d=null,m={},w={rgenId:0,ruleNames:[],rules:m,terminal:g={},lexIndex:{},ruleIndex:{}},i.splice(i.length,0,"$end",[[r,"$"]]),c=-1,l=i.length;l--;)if(p=i[++c],b(p)){if(!j.test(p))throw new Error("Invalid grammar rule name "+p);d=p}else{if(!I(p))throw new Error("Invalid item in definitions parameter.");if(!d)throw new Error("Invalid grammar rules parameter.");for(f=-1,h=p.length;h--;)E(d,p[++f],w,t)}if(u)for(u=u.slice(0),v=x.regex,l=u.length;l--;){if(p=u[l],!v(p))throw new Error("Invalid exclude token parameter.");d="/"+p.source+"/",d in g?u.splice(l,1):(t.define([d,p]),g[d]=d,u[l]=d)}if(!x.contains(m,r))throw new Error("Invalid root grammar rule parameter.");return s(w,e,u)}var o=t(0),s=t(7),a=/^([A-Z][a-zA-Z]+(\_?[a-zA-Z0-9])*|\$end|\$)$/;r.exports=i},function(r,e,t){"use strict";function n(r,e,t){var n,o,s,a,u,c,l,f,h,d,p=i,m=r.rules,w=new p(e,e.start),v=[[w,"$end"]],g=1;for(e.reset(),t&&e.setExcludes(t);g--;)for(n=v.splice(0,1)[0],u=n[0],o=n[1],s=m[o];s;s=d)c=s[0],d=s[2],!1===c?(l=0,w=u):(a=s[1],l++,a in m&&(h=w.rid,(h=h?h+"-"+c:c)in w||(f=w.clone(c),f[h]=f,v[g++]=[f,a])),w=w.point(a),d&&!1!==d[0]||w.reduce(o,l));return!0}var i=t(9);r.exports=n},function(r,e,t){"use strict";function n(){this.reset()}var i=t(0);n.prototype={stateGen:0,constructor:n,generateState:function(){var r="s"+ ++this.stateGen;return this.states[r]={},r},setAnchorState:function(r){r in this.anchors||(this.anchors[r]=!0)},setReduceState:function(r,e,t){var n,i=this.ends;if(r in i){if(n=i[r],n[0]!==e||n[1]!==t)throw console.log(this),new Error("Reduce conflict found "+n[0]+" ! <- "+e)}else i[r]=[e,t]},reset:function(){var r={};r.$start={},this.start="$start",this.states=r,this.anchors={},this.ends={},this.exclude={}},setExcludes:function(r){var e,t,n=this.exclude;if(i.array(r))for(e=-1,t=r.length;t--;)n[r[++e]]=!0},importStates:function(r){var e,t,n,o,s=i,a=s.object;if(!a(r))throw new Error("Invalid Object definition parameter.");if(t=r.states,!a(t))throw new Error('Invalid "states" Object in definition parameter.');if(e=r.start,!(s.string(e)&&e in t))throw new Error('Invalid "start" state in definition parameter.');if(n=r.anchors,!a(n))throw new Error('Invalid "anchors" states in definition parameter.');if(o=r.ends,!a(n))throw new Error('Invalid "ends" states in definition parameter.');return this.start=e,this.states=t,this.anchors=n,this.ends=o,!0},toObject:function(){return{start:this.start,states:this.states,anchors:this.anchors,ends:this.ends}},exportStates:function(r){var e=this.toObject();if(!0===r)try{return JSON.stringify(e)}catch(r){return null}return e}},r.exports=n},function(r,e,t){"use strict";function n(r,e){this.id=e,this.map=r,this.pointer={},this.lexemes=[]}var i=t(3);n.prototype={constructor:n,id:null,pointer:null,parent:null,rid:null,lexemes:null,clone:function(r){var e=i.clone(this);return r&&(e.rid=r),e.parent=this,e},point:function(r){var e,t,n=this.pointer,i=this.lexemes,o=this.map;return r in n||(t=this.map.generateState(),e=this.clone(),e.id=t,e.pointer={},e.lexemes=[],i[i.length]=r,n[r]=e,o.states[this.id][r]=t),n[r]},reduce:function(r,e){this.map.setReduceState(this.id,r,e)}},r.exports=n},function(r,t){r.exports=e},function(r,e,t){r.exports=t(2)}])});