!function(r,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("libcore"),require("libcore-tokenizer")):"function"==typeof define&&define.amd?define("libcore-parser-lalr",["libcore","libcore-tokenizer"],t):"object"==typeof exports?exports["libcore-parser-lalr"]=t(require("libcore"),require("libcore-tokenizer")):r["libcore-parser-lalr"]=t(r.libcore,r.libcoreTokenizer)}(this,function(r,t){return function(r){function t(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var e={};return t.m=r,t.c=e,t.i=function(r){return r},t.d=function(r,e,n){t.o(r,e)||Object.defineProperty(r,e,{configurable:!1,enumerable:!0,get:n})},t.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(e,"a",e),e},t.o=function(r,t){return Object.prototype.hasOwnProperty.call(r,t)},t.p="/assets/",t(t.s=11)}([function(t,e){t.exports=r},function(r,t,e){"use strict";function n(r,t){var e=o,n=s;if(!e.string(r))throw new Error("Invalid iterator name parameter.");if(!e.method(t)||t!==n&&!(t.prototype instanceof n))throw new Error("Invalid iterator Class parameter.");return a[":"+r]=t,!0}function i(r){var t=a;return o.string(r)&&(r=":"+r)in t?t[r]:null}var o=e(0),s=e(4),a={};n("base",s),r.exports={defaultIterator:"base",Base:s,register:n,get:i}},function(r,t,e){"use strict";function n(r,t,e){return new a(r,t,e)}function i(r){var t,e=s;if(e.string(r))try{r=JSON.parse(r)}catch(r){throw new Error("Unable to load from invalid json JSON String parameter: "+r.toString())}else if(!e.object(r))throw new Error("Unable to load from invalid json Object parameter.");t=new a;try{t.fromJSON(r)}catch(r){throw new Error(r)}return t}function o(r){return r instanceof a}var s=e(0),a=e(5),u=e(1);r.exports={Parser:a,Iterator:u.Base,isParser:o,define:n,load:i,registerIterator:u.register}},function(r,t,e){"use strict";function n(){}function i(r){var t=n;return t.prototype=r,new t}r.exports={clone:i}},function(r,t,e){"use strict";function n(r){if(!i.object(r))throw new Error("Invalid parser parameter.");this.parser=r,this.reset(),this.start=":start"}var i=e(0);n.prototype={constructor:n,subject:"",returns:!1,current:null,ready:!1,completed:!1,error:null,actions:{":start":{0:":fail",1:":shift",2:":reduce"},":shift":{0:":fail",1:":start"},":reduce":{0:":fail",1:":shift",2:":reduce",3:":success"},":fail":{},":success":{}},":start":function(){for(var r,t,e,n=this,i=n.parser,o=i.map,s=o.states,a=o.ends,u=o.exclude,l=i.tokenizer,c=n.nextTokenIndex,f=n.pstate,h=l.tokenize(c,n.subject);h&&(r=h[0])in u;h=l.tokenize(c,n.subject))c=h[2];return h&&(t=s[f],e=h[2],n.nextTokenIndex=e,n.params={name:r,params:0,value:h[1],from:c,to:e},r in t)?1:n.buffer.length?f in a?2:(n.params="failed reduce!",0):(n.params="Failed from start",0)},":shift":function(r){var t=this,e=t.buffer,n=t.parser.map.states,i=t.pstate,o=r.name;return e[e.length]=[i,r],t.pstate=n[i][o],t.current=r,t.params=null,t.returns=!0,1},":reduce":function(r){for(var t,e,n,i,o,s,a=this,u=a.parser.map,l=a.buffer,c=l.length,f=u.ends,h=u.states,d=a.pstate,p=f[d],m=p[0],w=p[1],v=[],g=w,b=g-1;g--;)e=l[--c],d=e[0],t=e[1],n=t.from,g===b&&(i=t.to),v[g]=t;return l.length=c,a.current=s={name:m,params:w,value:v,from:n,to:i},"$Root"===m?0===c?(a.params=s,3):(a.params="Failed last reduce",0):(l[c++]=[d,s],a.returns=!0,d=h[d][m],o=h[d],m=r.name,a.pstate=d,m in o?1:d in f?2:(a.params="failed reduce! inside :reduce",0))},":success":function(r){var t=this;return t.completed=t.returns=!0,t.current=r,!1},":fail":function(r){var t=this;return t.error=r,t.completed=!0,!1},reset:function(){var r=this.parser;this.nextTokenIndex=0,this.cursor=0,this.buffer=[],this.state=this.start,this.pstate=r.map.start,this.params=null,this.subject||delete this.ready,delete this.complete,delete this.error,delete this.returns,delete this.current},set:function(r){if(!i.string(r))throw new Error("Invalid String subject parameter.");this.reset(),this.subject=r,this.ready=!0},next:function(){for(var r,t,e,n,o,s,a=this,u=a.actions,l=i.number,c=a.completed;!c;){if(r=a.state,t=a.params,!(r in a))throw new Error("No handler found for state "+r);if(e=a[r](t),n=a.returns,delete a.returns,s=a.current,c=a.completed,a.error)break;if(!c){if(!l(e))throw new Error("Invalid result from state handler"+r);if(o=u[r],!(e in o))throw new Error("Invalid result from state handler"+r);a.state=o[e]}if(!0===n)return s}return(!c||!a.error)&&null}},r.exports=n},function(r,t,e){"use strict";function n(r,t,e){this.tokenizer=new o,this.map=new s,arguments.length&&this.define(r,t,e)}var i=e(0),o=e(10),s=e(8),a=e(6),u=e(1);n.prototype={subject:"",tokenizer:null,map:null,ready:!1,constructor:n,iterator:function(r){var t,e=u;if(arguments.length){if(!(t=e.get(r)))throw new Error("Invalid iterator name parameter.")}else t=e.get(e.defaultIterator);return new t(this)},define:function(r,t,e){var n,o=i,s=o.array;if(s(e)||(e=[]),!o.string(r))throw new Error("Invalid root grammar rule parameter.");if(!s(t))throw new Error("Invalid grammar rules definition parameter");return this.ready=n=a(r,this.map,this.tokenizer,t,e),n},fromJSON:function(r){var t,e=i,n=e.object;if(e.string(r))try{r=JSON.parse(r)}catch(r){throw new Error("Invalid JSON String json parameter.")}if(!n(r))throw new Error("Invalid Object json parameter.");if(t=r.tokens,!n(t))throw new Error('Invalid "tokens" property of json parameter.');return this.tokenizer.fromJSON(t),this.map.importStates(r),this},toJSON:function(){return JSON.stringify(this.toObject())},toObject:function(){var r;if(!this.ready)throw new Error("Grammar rules is not yet defined.");return r=this.map.toObject(),r.tokens=this.tokenizer.toObject(),r},parse:function(r,t,e){var n,o,s,a=i,u=a.string,l=[],c=0;if(!u(r))throw new Error("Invalid string subject parameter");if(!(e=a.string(e)?this.iterator(e):this.iterator()))throw new Error("Invalid Iterator parameter.");for(a.object(t)||(t={}),e.set(r),n=e.next();n;n=e.next())l[c++]=n,(o=n.name)in t&&(s=t[o](o,n.value,n),void 0!==s?n.value=s:0!==n.params&&(n.value=null));return!e.error&&l}},r.exports=n},function(r,t,e){"use strict";function n(r,t,e,n){var i,s,u,l,c,f,h,d,p,m,w=e.rules,v=e.ruleIndex,g=e.terminal,b=e.lexIndex,x=e.ruleNames,I=a,E=o,j=E.string,y=E.regex;if((j(t)||y(t))&&(t=[t]),!E.array(t))throw new Error("Invalid grammar rule found in "+r);for(h=d=null,u=[],i=t.length;i--;){if(s=t[i],y(s))s.source,l="/"+s.source+"/",l in g||(n.define([l,s]),g[l]=l),s=l;else{if(!j(s))throw new Error("Invalid token in grammar rule "+s);if(!I.test(s))throw new Error("Invalid grammar rule name format: "+s)}u[i]=s,m="r"+ ++e.rgenId,b[m]=s,c=[m,s,h],h||(d=c),h=c}if(f=" -> "+u.join(","),r+":",(l=r+f)in v)throw new Error("Grammar rule is already defined "+r+f);v[l]=!0,r in w||(w[r]=null,x[x.length]=r),h=[!1,null,h],p=w[r],p&&(d[2]=p),w[r]=h}function i(r,t,e,i,u){var l,c,f,h,d,p,m,w,v,g,b=o,x=b.string,I=b.array,E=n,j=a;for(d=null,m={},w={rgenId:0,ruleNames:[],rules:m,terminal:g={},lexIndex:{},ruleIndex:{}},i.splice(i.length,0,"$Root",[[r,"$"]]),l=-1,c=i.length;c--;)if(p=i[++l],x(p)){if(!j.test(p))throw new Error("Invalid grammar rule name "+p);d=p}else{if(!I(p))throw new Error("Invalid item in definitions parameter.");if(!d)throw new Error("Invalid grammar rules parameter.");for(f=-1,h=p.length;h--;)E(d,p[++f],w,e)}if(u)for(u=u.slice(0),v=b.regex,c=u.length;c--;){if(p=u[c],!v(p))throw new Error("Invalid exclude token parameter.");d="/"+p.source+"/",d in g?u.splice(c,1):(e.define([d,p]),g[d]=d,u[c]=d)}if(!b.contains(m,r))throw new Error("Invalid root grammar rule parameter.");return s(w,t,u)}var o=e(0),s=e(7),a=/^([A-Z][a-zA-Z]+(\_?[a-zA-Z0-9])*|\$Root|\$)$/;r.exports=i},function(r,t,e){"use strict";function n(r,t,e){var n,o,s,a,u,l,c,f,h,d,p=i,m=r.rules,w=new p(t,t.start),v=[[w,"$Root"]],g=1;for(t.reset(),e&&t.setExcludes(e);g--;)for(n=v.splice(0,1)[0],u=n[0],o=n[1],s=m[o];s;s=d)l=s[0],d=s[2],!1===l?(c=0,w=u):(a=s[1],c++,a in m&&(h=w.rid,(h=h?h+"-"+l:l)in w||(f=w.clone(l),f[h]=f,v[g++]=[f,a])),w=w.point(a),d&&!1!==d[0]||w.reduce(o,c));return!0}var i=e(9);r.exports=n},function(r,t,e){"use strict";function n(){this.reset()}var i=e(0);n.prototype={stateGen:0,constructor:n,generateState:function(){var r="s"+ ++this.stateGen;return this.states[r]={},r},setAnchorState:function(r){r in this.anchors||(this.anchors[r]=!0)},setReduceState:function(r,t,e){var n,i=this.ends;if(r in i){if(n=i[r],n[0]!==t||n[1]!==e)throw console.log(this),new Error("Reduce conflict found "+n[0]+" ! <- "+t)}else i[r]=[t,e]},reset:function(){var r={};r.$start={},this.start="$start",this.states=r,this.anchors={},this.ends={},this.exclude={}},setExcludes:function(r){var t,e,n=this.exclude;if(i.array(r))for(t=-1,e=r.length;e--;)n[r[++t]]=!0},importStates:function(r){var t,e,n,o,s=i,a=s.object;if(!a(r))throw new Error("Invalid Object definition parameter.");if(e=r.states,!a(e))throw new Error('Invalid "states" Object in definition parameter.');if(t=r.start,!(s.string(t)&&t in e))throw new Error('Invalid "start" state in definition parameter.');if(n=r.anchors,!a(n))throw new Error('Invalid "anchors" states in definition parameter.');if(o=r.ends,!a(n))throw new Error('Invalid "ends" states in definition parameter.');return this.start=t,this.states=e,this.anchors=n,this.ends=o,!0},toObject:function(){return{start:this.start,states:this.states,anchors:this.anchors,ends:this.ends}},exportStates:function(r){var t=this.toObject();if(!0===r)try{return JSON.stringify(t)}catch(r){return null}return t}},r.exports=n},function(r,t,e){"use strict";function n(r,t){this.id=t,this.map=r,this.pointer={},this.lexemes=[]}var i=e(3);n.prototype={constructor:n,id:null,pointer:null,parent:null,rid:null,lexemes:null,clone:function(r){var t=i.clone(this);return r&&(t.rid=r),t.parent=this,t},point:function(r){var t,e,n=this.pointer,i=this.lexemes,o=this.map;return r in n||(e=this.map.generateState(),t=this.clone(),t.id=e,t.pointer={},t.lexemes=[],i[i.length]=r,n[r]=t,o.states[this.id][r]=e),n[r]},reduce:function(r,t){this.map.setReduceState(this.id,r,t)}},r.exports=n},function(r,e){r.exports=t},function(r,t,e){r.exports=e(2)}])});